C51 COMPILER V9.59.0.0   TIMER                                                             01/22/2025 20:49:40 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE TIMER
OBJECT MODULE PLACED IN .\Objects\Timer.obj
COMPILER INVOKED BY: D:\keil\C51\BIN\C51.EXE HardWare\Timer.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\User;.\HardWare;.\EEPROM
                    -;.\Delay) DEBUG OBJECTEXTEND PRINT(.\Listings\Timer.lst) OBJECT(.\Objects\Timer.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "Timer.h"
   3          #include "DDTube.h"
   4          #include "Buzzer.h"
   5          
   6          //å¤–éƒ¨å˜é‡å’Œå‡½æ•°å£°æ˜
   7          extern unsigned char count;
   8          extern unsigned char minute;
   9          extern char second;
  10          extern unsigned char S24_time;   //24Sè§„åˆ™
  11          extern bit S24_flag;//æ˜¯å¦ä½¿ç”¨24sè§„åˆ™
  12          extern void SaveAT2402();
  13          
  14          //å®šä¹‰å˜é‡
  15          unsigned int TempCounter=1500;//æ¯1.5sæ›´æ–°ä¸€æ¬¡æ¸©åº¦
  16          bit sflag_updateTem=1;
  17          bit sflag_SaveAT2402=0;
  18          
  19          /**
  20            * @brief  å®šæ—¶å™¨0åˆå§‹åŒ–ï¼Œ1æ¯«ç§’@12.000MHz
  21            * @param  æ— 
  22            * @retval æ— 
  23            */
  24          void Timer0_Init(void)
  25          {
  26   1              TMOD |= 0x01;           //è®¾ç½®å®šæ—¶å™¨0ä¸ºå·¥ä½œæ–¹å¼1
  27   1              TH0 = 0x3C;             //è®¾ç½®å®šæ—¶åˆå€¼
  28   1              TL0 = 0xB0;             //è®¾ç½®å®šæ—¶åˆå€¼ï¼Œ50ms
  29   1              TF0 = 0;                //æ¸…é™¤TF0æ ‡å¿—
  30   1              TR0 = 0;                //å®šæ—¶å™¨0å…³é—­è®¡æ—¶
  31   1              ET0=1;
  32   1              EA=1;
  33   1              PT0=0;
  34   1      }
  35          
  36          
  37          void Timer1_Init(void)
  38          {
  39   1              TMOD |= 0x10;           //è®¾ç½®å®šæ—¶å™¨1ä¸ºå·¥ä½œæ–¹å¼1
  40   1              TH1 = 0xFC;             //è®¾ç½®å®šæ—¶åˆå€¼
  41   1              TL1 = 0x18;             //è®¾ç½®å®šæ—¶åˆå€¼ï¼Œ1ms
  42   1              TF1 = 0;                //æ¸…é™¤TF1æ ‡å¿—
  43   1              TR1 = 0;                //å®šæ—¶å™¨1å…³é—­è®¡æ—¶
  44   1              ET1=1;
  45   1              EA=1;
  46   1              PT1=1;//å®šæ—¶å™¨1é«˜ä¼˜å…ˆçº§
  47   1              TR1=1;//å¯åŠ¨å®šæ—¶å™¨1.å®šæ—¶å™¨1åªè´Ÿè´£åˆ·æ–°æ˜¾ç¤ºæ•°ç ç®¡ï¼Œåˆ·æ–°æ¸©åº¦æ˜¾ç¤º
  48   1      }
  49          
  50          //å®šæ—¶å™¨0ä¸­æ–­æœåŠ¡å‡½æ•°
  51          void Timer0_Routine() interrupt 1
  52          {
  53   1              
  54   1              if(count-- == 0)          //è®¡æ—¶1ç§’
C51 COMPILER V9.59.0.0   TIMER                                                             01/22/2025 20:49:40 PAGE 2   

  55   1              {
  56   2                      
  57   2              count = 20;
  58   2                      second--;
  59   2                      if(S24_flag)         //24ç§’è§„åˆ™å¯ç”¨
  60   2              {
  61   3                  S24_time--;
  62   3                              
  63   3              }
  64   2              // SaveAT2402();//æ¯ç§’å­˜å…¥æ•°æ®    è¿™ä¸ªåœ°æ–¹ç›´æ¥è°ƒç”¨å­˜å‚¨å‡½æ•°å¯¼è‡´ä¸­æ–­æœåŠ¡å‡½æ
             -•°æ—¶é—´å¤ªé•¿äº†ï¼Œå¯¼è‡´åè¾¹æ•°ç ç®¡é—ªçƒå’Œæ¸©åº¦ä¼ æ„Ÿå™¨æ˜¾ç¤ºä¹±è·³çš„bugï¼Œè¿™é‡Œè®¾ç½®
  65   2                                                                                      //ä¸€ä¸ªæ ‡å¿—ä½æ¥å®ç°ï¼Œåœ¨å¤–éƒ¨å®ç°å­˜å–æ•°æ®
  66   2                      sflag_SaveAT2402=~sflag_SaveAT2402;
  67   2              }
  68   1      
  69   1              TH0 = 0x3C;             //è®¾ç½®å®šæ—¶åˆå€¼
  70   1              TL0 = 0xB0;             //è®¾ç½®å®šæ—¶åˆå€¼ï¼Œ50ms
  71   1      
  72   1      }
  73          
  74          
  75          //å®šæ—¶å™¨1ä¸­æ–­æœåŠ¡å‡½æ•°
  76          void Timer1_Routine() interrupt 3
  77          {
  78   1      
  79   1              DDTube_Loop();//1msè°ƒç”¨ä¸€æ¬¡æ•°ç ç®¡é©±åŠ¨å‡½æ•°
  80   1              TempCounter--;
  81   1              if(TempCounter<=0){
  82   2                      TempCounter=1500;
  83   2                      sflag_updateTem=~sflag_updateTem;
  84   2              }
  85   1              TH1 = 0xFC;             //è®¾ç½®å®šæ—¶åˆå€¼
  86   1              TL1 = 0x18;             //è®¾ç½®å®šæ—¶åˆå€¼ï¼Œ1ms
  87   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    175    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
